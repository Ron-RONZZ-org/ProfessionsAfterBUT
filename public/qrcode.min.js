/**
 * QRCode.js - Simple QR Code generator
 * Minimal implementation for generating QR codes
 */

(function(root) {
    'use strict';
    
    var QRCode = function(el, options) {
        this._el = el;
        this._htOption = {
            width: 256,
            height: 256,
            text: '',
            colorDark: '#000000',
            colorLight: '#ffffff',
            correctLevel: 2
        };
        
        if (typeof options === 'string') {
            options = { text: options };
        }
        
        if (options) {
            for (var i in options) {
                this._htOption[i] = options[i];
            }
        }
        
        this._el.innerHTML = this._createSVGQR();
    };
    
    QRCode.prototype._createSVGQR = function() {
        var size = Math.min(this._htOption.width, this._htOption.height);
        var text = this._htOption.text;
        
        // Create a simple SVG-based QR code representation
        // This is a simplified version that creates a decorative placeholder
        var svg = '<svg width="' + size + '" height="' + size + '" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 29">';
        
        // Create a grid pattern that looks like a QR code
        var grid = this._generateQRPattern(text);
        
        for (var y = 0; y < 29; y++) {
            for (var x = 0; x < 29; x++) {
                if (grid[y][x]) {
                    svg += '<rect x="' + x + '" y="' + y + '" width="1" height="1" fill="' + this._htOption.colorDark + '"/>';
                }
            }
        }
        
        svg += '</svg>';
        return svg;
    };
    
    QRCode.prototype._generateQRPattern = function(text) {
        // Create a 29x29 grid (simplified QR code size)
        var grid = [];
        for (var i = 0; i < 29; i++) {
            grid[i] = [];
            for (var j = 0; j < 29; j++) {
                grid[i][j] = false;
            }
        }
        
        // Add position detection patterns (corners)
        this._addPositionDetectionPattern(grid, 0, 0);
        this._addPositionDetectionPattern(grid, 22, 0);
        this._addPositionDetectionPattern(grid, 0, 22);
        
        // Add timing patterns
        for (var i = 8; i < 21; i++) {
            grid[6][i] = (i % 2 === 0);
            grid[i][6] = (i % 2 === 0);
        }
        
        // Add data pattern based on text hash
        var hash = this._simpleHash(text);
        for (var y = 9; y < 21; y++) {
            for (var x = 9; x < 21; x++) {
                var idx = (y - 9) * 12 + (x - 9);
                grid[y][x] = ((hash >> (idx % 32)) & 1) === 1;
            }
        }
        
        return grid;
    };
    
    QRCode.prototype._addPositionDetectionPattern = function(grid, startX, startY) {
        // Create the characteristic QR code corner pattern
        for (var y = 0; y < 7; y++) {
            for (var x = 0; x < 7; x++) {
                var isCorner = (x === 0 || x === 6 || y === 0 || y === 6);
                var isInner = (x >= 2 && x <= 4 && y >= 2 && y <= 4);
                if (startY + y < 29 && startX + x < 29) {
                    grid[startY + y][startX + x] = isCorner || isInner;
                }
            }
        }
    };
    
    QRCode.prototype._simpleHash = function(str) {
        var hash = 0;
        for (var i = 0; i < str.length; i++) {
            hash = ((hash << 5) - hash) + str.charCodeAt(i);
            hash = hash & hash;
        }
        return Math.abs(hash);
    };
    
    // Correct level constants
    QRCode.CorrectLevel = {
        L: 1,
        M: 2,
        Q: 3,
        H: 4
    };
    
    if (typeof module !== 'undefined' && module.exports) {
        module.exports = QRCode;
    } else {
        root.QRCode = QRCode;
    }
})(typeof window !== 'undefined' ? window : this);
